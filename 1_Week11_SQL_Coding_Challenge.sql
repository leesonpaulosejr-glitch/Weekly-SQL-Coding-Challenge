DROP DATABASE IF EXISTS company;
CREATE DATABASE company;
USE company;

CREATE TABLE department (
    deptno INT PRIMARY KEY,
    dname VARCHAR(50),
    loc VARCHAR(50)
);

CREATE TABLE employee (
    empno INT PRIMARY KEY,
    ename VARCHAR(50),
    job VARCHAR(50),
    mgr INT,
    hiredate DATE,
    sal DECIMAL(10,2),
    comm DECIMAL(10,2),
    deptno INT,
    FOREIGN KEY (deptno) REFERENCES department(deptno)
);

CREATE TABLE grade (
    grade INT,
    losal INT,
    hisal INT
);

INSERT INTO department VALUES
(10,'ACCOUNTING','NEW YORK'),
(20,'RESEARCH','DALLAS'),
(30,'SALES','CHICAGO'),
(40,'OPERATIONS','BOSTON');

INSERT INTO employee VALUES
(7369,'SMITH','CLERK',7902,'1980-12-17',800,NULL,20),
(7499,'ALLEN','SALESMAN',7698,'1981-02-20',1600,300,30),
(7521,'WARD','SALESMAN',7698,'1981-02-22',1250,500,30),
(7566,'JONES','MANAGER',7839,'1981-04-02',2975,NULL,20),
(7654,'MARTIN','SALESMAN',7698,'1981-09-28',1250,1400,30),
(7698,'BLAKE','MANAGER',7839,'1981-05-01',2850,NULL,30),
(7782,'CLARK','MANAGER',7839,'1981-06-09',2450,NULL,10),
(7788,'SCOTT','ANALYST',7566,'1987-07-13',3000,NULL,20),
(7839,'KING','PRESIDENT',NULL,'1981-11-17',5000,NULL,10),
(7844,'TURNER','SALESMAN',7698,'1981-09-08',1500,0,30),
(7876,'ADAMS','CLERK',7788,'1987-07-13',1100,NULL,20),
(7900,'JAMES','CLERK',7698,'1981-12-03',950,NULL,30),
(7902,'FORD','ANALYST',7566,'1981-12-03',3000,NULL,20),
(7934,'MILLER','CLERK',7782,'1982-01-23',1300,NULL,10);

INSERT INTO grade VALUES
(1,700,1200),
(2,1201,1400),
(3,1401,2000),
(4,2001,3000),
(5,3001,9999);

SELECT * FROM department;
SELECT * FROM employee;
SELECT * FROM grade;

-- SECTION 1: BASIC SELECT QUERIES
-- Display all information about all employees
SELECT * FROM EMPLOYEE;

-- Employee number, name, salary
SELECT EMPNO, ENAME, SAL FROM EMPLOYEE;

-- Unique job titles
SELECT DISTINCT JOB FROM EMPLOYEE;

-- Employee name and annual salary
SELECT ENAME, SAL * 12 AS ANNUAL_SALARY FROM EMPLOYEE;

-- Employees from department 10
SELECT * FROM EMPLOYEE WHERE DEPTNO = 10;

-- Name and job of CLERKs
SELECT ENAME, JOB FROM EMPLOYEE WHERE JOB = 'CLERK';

-- Names starting with S
SELECT ENAME FROM EMPLOYEE WHERE ENAME LIKE 'S%';

-- Second letter is L
SELECT ENAME FROM EMPLOYEE WHERE ENAME LIKE '_L%';

-- Names containing AR
SELECT ENAME FROM EMPLOYEE WHERE ENAME LIKE '%AR%';

-- Hired in 1981
SELECT * FROM EMPLOYEE WHERE YEAR(HIREDATE) = 1981;

-- Salary > 2500
SELECT ENAME, SAL FROM EMPLOYEE WHERE SAL > 2500;

-- Not MANAGER
SELECT * FROM EMPLOYEE WHERE JOB <> 'MANAGER';

-- Employees with commission
SELECT * FROM EMPLOYEE WHERE COMM IS NOT NULL;

-- Employees without manager
SELECT * FROM EMPLOYEE WHERE MGR IS NULL;

-- Dept 30 SALESMAN
SELECT ENAME FROM EMPLOYEE WHERE DEPTNO = 30 AND JOB = 'SALESMAN';

-- CLERKs and ANALYSTs
SELECT ENAME FROM EMPLOYEE WHERE JOB IN ('CLERK', 'ANALYST');

-- Salary between 1000 and 2000
SELECT ENAME FROM EMPLOYEE WHERE SAL BETWEEN 1000 AND 2000;

-- SECTION 2: ORDERING & GROUPING
-- Order by name
SELECT * FROM EMPLOYEE ORDER BY ENAME;

-- Order by dept, salary desc
SELECT * FROM EMPLOYEE ORDER BY DEPTNO, SAL DESC;

-- Total employees
SELECT COUNT(*) FROM EMPLOYEE;

-- Total salary
SELECT SUM(SAL) FROM EMPLOYEE;

-- Average salary
SELECT AVG(SAL) FROM EMPLOYEE;

-- Max & Min salary
SELECT MAX(SAL), MIN(SAL) FROM EMPLOYEE;

-- Employees per department
SELECT DEPTNO, COUNT(*) FROM EMPLOYEE GROUP BY DEPTNO;

-- Avg salary per job
SELECT JOB, AVG(SAL) FROM EMPLOYEE GROUP BY JOB;

-- Total salary per department
SELECT DEPTNO, SUM(SAL) FROM EMPLOYEE GROUP BY DEPTNO;

-- Departments with >3 employees
SELECT DEPTNO FROM EMPLOYEE GROUP BY DEPTNO HAVING COUNT(*) > 3;

-- Jobs with avg salary > 2000
SELECT JOB FROM EMPLOYEE GROUP BY JOB HAVING AVG(SAL) > 2000;

-- SECTION 3: JOINS & SUBQUERIES
-- Employee name & department name
SELECT E.ENAME, D.DNAME
FROM EMPLOYEE E
JOIN DEPARTMENT D ON E.DEPTNO = D.DEPTNO;

-- Employee, dept, location
SELECT E.ENAME, D.DNAME, D.LOC
FROM EMPLOYEE E
JOIN DEPARTMENT D ON E.DEPTNO = D.DEPTNO;

-- Employee and manager name
SELECT E.ENAME AS EMPLOYEE, M.ENAME AS MANAGER
FROM EMPLOYEE E
LEFT JOIN EMPLOYEE M ON E.MGR = M.EMPNO;

-- Employee name, salary, grade
SELECT E.ENAME, E.SAL, G.GRADE
FROM EMPLOYEE E
JOIN GRADE G ON E.SAL BETWEEN G.LOSAL AND G.HISAL;

-- Employees working in NEW YORK
SELECT ENAME FROM EMPLOYEE
WHERE DEPTNO = (SELECT DEPTNO FROM DEPARTMENT WHERE LOC = 'NEW YORK');

-- Department where SMITH works
SELECT DNAME FROM DEPARTMENT
WHERE DEPTNO = (SELECT DEPTNO FROM EMPLOYEE WHERE ENAME = 'SMITH');

-- Employees earning more than ALLEN
SELECT ENAME FROM EMPLOYEE
WHERE SAL > (SELECT SAL FROM EMPLOYEE WHERE ENAME = 'ALLEN');

-- Same department as SCOTT
SELECT ENAME FROM EMPLOYEE
WHERE DEPTNO = (SELECT DEPTNO FROM EMPLOYEE WHERE ENAME = 'SCOTT');

-- Same job as JONES
SELECT ENAME FROM EMPLOYEE
WHERE JOB = (SELECT JOB FROM EMPLOYEE WHERE ENAME = 'JONES');

-- Managers managing more than 2 employees
SELECT MGR FROM EMPLOYEE
GROUP BY MGR
HAVING COUNT(*) > 2;

-- SECTION 4: FUNCTIONS
-- Names in lowercase
SELECT LOWER(ENAME) FROM EMPLOYEE;

-- First 3 letters
SELECT SUBSTRING(ENAME,1,3) FROM EMPLOYEE;

-- Length of name
SELECT ENAME, LENGTH(ENAME) FROM EMPLOYEE;

-- Salary rounded to nearest thousand
SELECT ROUND(SAL, -3) FROM EMPLOYEE;

-- Remainder of salary / 1000
SELECT MOD(SAL,1000) FROM EMPLOYEE;

-- Current date & time
SELECT NOW();

-- Hire year
SELECT ENAME, YEAR(HIREDATE) FROM EMPLOYEE;

-- Hire month
SELECT ENAME, MONTHNAME(HIREDATE) FROM EMPLOYEE;

-- Years with company (assuming 2025)
SELECT ENAME, (2025 - YEAR(HIREDATE)) AS YEARS_WORKED FROM EMPLOYEE;

-- SECTION 5: DDL & DML
-- Create DEPARTMENT table
CREATE TABLE DEPARTMENT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    LOC VARCHAR(50)
);

-- Add PINCODE column
ALTER TABLE DEPARTMENT ADD PINCODE INT;

-- Insert department 50
INSERT INTO DEPARTMENT VALUES (50, 'HR', 'HOUSTON', NULL);

-- Update SALES location
UPDATE DEPARTMENT SET LOC = 'ATLANTA' WHERE DNAME = 'SALES';

-- Delete OPERATIONS department
DELETE FROM DEPARTMENT WHERE DNAME = 'OPERATIONS';


